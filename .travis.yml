language: node_js

node_js:
  - '10'

install:
  - npm install -g @tarojs/cli
  - npm install

script:
  - npm run lint
  - npm run ui:ci
  - npm run test

after_script:
  - if [ "$TRAVIS_BRANCH" == "master" ] && [ "${TRAVIS_PULL_REQUEST}" == "false" ]; then
      npm run update:site;
    fi

branches:
  only:
    - master

before_deploy: npm run ui:ci

deploy:
  provider: npm
  email: love@onelong.org
  skip_cleanup: true
  api_key:
    secure: $NPM_TOKEN
  on:
    tags: true
    branch: master
  tag: latest

env:
  - GH_REF: github.com/loveonelong/xcandy.git
